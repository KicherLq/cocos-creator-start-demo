{"version":3,"sources":["file:///C:/Users/ctwl/Downloads/cocos-nodejs-io-game-start-demo-master/apps/client/assets/Scripts/Entity/Bullet/BulletManager.ts"],"names":["_decorator","instantiate","EntityManager","EntityTypeEnum","BulletStateMachine","EntityStateEnum","EventEnum","DataManager","rad2Angle","EventManager","ExplosionManager","ccclass","property","BulletManager","type","__id","init","data","id","fsm","addComponent","state","Idle","node","active","Instance","on","explosionBorn","handleExplosionBorn","x","y","prefab","prefabMap","get","Explosion","explosion","setParent","stage","em","off","bulletMap","delete","destroy","render","direction","position","setPosition","side","Math","sqrt","angle","asin","rightAngle"],"mappings":"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","sourcesContent":["import { _decorator, Component } from 'cc';\r\nimport { EntityManager } from '../../Base/EntityManager';\r\nimport { IBullet, IVec2 } from '../../Common/State';\r\nimport { EntityTypeEnum, InputTypeEnum } from '../../Common/Enum';\r\nimport { BulletStateMachine } from './BulletStateMachine';\r\nimport { EntityStateEnum, EventEnum } from '../../Enum';\r\nimport DataManager from '../../Global/DataManager';\r\nimport { rad2Angle } from '../../Utils';\r\nimport EventManager from '../../Global/EventManager';\r\nimport { instantiate } from 'cc';\r\nimport { ExplosionManager } from '../Explosion/ExplosionManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('BulletManager')\r\nexport class BulletManager extends EntityManager {\r\n    public type: EntityTypeEnum;\r\n    private __id: number;\r\n\r\n    init(data: IBullet) {\r\n        this.type = data.type;\r\n        this.__id = data.id;\r\n        this.fsm = this.addComponent(BulletStateMachine);\r\n        this.fsm.init(data.type);\r\n\r\n        this.state = EntityStateEnum.Idle;\r\n        this.node.active = false;\r\n\r\n        EventManager.Instance.on(EventEnum.explosionBorn, this.handleExplosionBorn, this);\r\n    }\r\n\r\n    handleExplosionBorn(id: number, {x, y}: IVec2) {\r\n        if(id !== this.__id) {\r\n            return;\r\n        }\r\n\r\n        //处理子弹爆炸特效相关逻辑\r\n        const prefab = DataManager.Instance.prefabMap.get(EntityTypeEnum.Explosion);\r\n        const explosion = instantiate(prefab);\r\n        explosion.setParent(DataManager.Instance.stage);\r\n        const em = explosion.addComponent(ExplosionManager);\r\n        em.init(EntityTypeEnum.Explosion, {x, y});\r\n\r\n        //处理子弹销毁的相关逻辑\r\n        EventManager.Instance.off(EventEnum.explosionBorn, this.handleExplosionBorn, this);\r\n        DataManager.Instance.bulletMap.delete(this.__id);\r\n        this.node.destroy();\r\n    }\r\n\r\n    render(data: IBullet) {\r\n        this.node.active = true;\r\n        const {direction, position} = data;\r\n        this.node.setPosition(position.x, position.y);\r\n        \r\n        const side = Math.sqrt(direction.x ** 2 + direction.y ** 2);\r\n        const angle = rad2Angle(Math.asin(direction.y / side));\r\n        const rightAngle = rad2Angle(Math.asin(-direction.y / side)) + 180;\r\n        this.node.angle = direction.x > 0 ? angle : rightAngle;\r\n    }\r\n    \r\n}"]}