{"version":3,"sources":["file:///C:/Users/ctwl/Downloads/cocos-nodejs-io-game-start-demo-master/apps/client/assets/Scripts/Entity/Actor/ActorManager.ts"],"names":["_decorator","instantiate","ProgressBar","DataManager","EntityTypeEnum","InputTypeEnum","EntityManager","ActorStateMachine","EntityStateEnum","WeaponManager","rad2Angle","ccclass","property","ActorManager","bulletType","__wm","__id","__hp","init","data","node","getComponentInChildren","id","fsm","addComponent","type","state","Idle","prefeb","Instance","prefabMap","get","Weapon1","weapon","setParent","tick","deltaTime","myPlayerId","jm","output","length","x","y","applyInput","ActorMove","direction","Run","render","position","setPosition","setScale","side","Math","sqrt","rad","asin","angle","progress","hp","totalLength"],"mappings":"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","sourcesContent":["import { _decorator, Component, input } from 'cc';\r\nimport DataManager from \"../../Global/DataManager\";\r\nimport { EntityTypeEnum, InputTypeEnum } from '../../Common/Enum';\r\nimport { IActor } from '../../Common/State';\r\nimport { EntityManager } from '../../Base/EntityManager';\r\nimport { ActorStateMachine } from './ActorStateMachine';\r\nimport { EntityStateEnum } from '../../Enum';\r\nimport { instantiate } from 'cc';\r\nimport { WeaponManager } from '../Weapon/WeaponManager';\r\nimport { rad2Angle } from '../../Utils';\r\nimport { ProgressBar } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ActorManager')\r\nexport class ActorManager extends EntityManager {\r\n    public bulletType: EntityTypeEnum;\r\n    private __wm: WeaponManager = null;\r\n    private __id: number = 1;\r\n    private __hp: ProgressBar = null;\r\n\r\n    init(data: IActor) {\r\n        this.bulletType = data.bulletType;\r\n        this.__hp = this.node.getComponentInChildren(ProgressBar);\r\n        this.__id = data.id;\r\n        this.fsm = this.addComponent(ActorStateMachine);\r\n        this.fsm.init(data.type);\r\n\r\n        this.state = EntityStateEnum.Idle;\r\n        const prefeb = DataManager.Instance.prefabMap.get(EntityTypeEnum.Weapon1);\r\n        const weapon = instantiate(prefeb);\r\n        weapon.setParent(this.node);\r\n        this.__wm = weapon.addComponent(WeaponManager);\r\n        this.__wm.init(data);\r\n    }\r\n\r\n    tick(deltaTime: number) {\r\n        if(DataManager.Instance.myPlayerId !== this.__id) {\r\n            return;\r\n        }\r\n        if(DataManager.Instance.jm.output.length()) {\r\n            const {x, y} = DataManager.Instance.jm.output;\r\n            DataManager.Instance.applyInput({\r\n                id: 1,\r\n                type: InputTypeEnum.ActorMove,\r\n                direction: {\r\n                    x,\r\n                    y\r\n                },\r\n                deltaTime,\r\n            });\r\n\r\n            this.state = EntityStateEnum.Run;\r\n        } else {\r\n            this.state = EntityStateEnum.Idle;\r\n        }\r\n    }\r\n\r\n    render(data: IActor) {\r\n        const {direction, position} = data;\r\n        this.node.setPosition(position.x, position.y);\r\n        if(direction.x !== 0) {\r\n            this.node.setScale(direction.x > 0 ? 1 : -1, 1);\r\n        }\r\n\r\n        const side = Math.sqrt(direction.x ** 2 + direction.y ** 2);\r\n        const rad = Math.asin(direction.y / side);\r\n        const angle = rad2Angle(rad);\r\n        this.__wm.node.angle = angle;\r\n\r\n        this.__hp.progress = data.hp / this.__hp.totalLength;\r\n    }\r\n}"]}