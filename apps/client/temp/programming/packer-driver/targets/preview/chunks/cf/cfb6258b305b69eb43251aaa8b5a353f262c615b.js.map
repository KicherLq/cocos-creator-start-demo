{"version":3,"sources":["file:///C:/Users/ctwl/Downloads/cocos-nodejs-io-game-start-demo-master/apps/client/assets/Scripts/UI/JoyStickManager.ts"],"names":["Input","UITransform","Vec2","input","_decorator","Component","ccclass","property","JoyStickManager","output","ZERO","_body","_stick","_defaultPos","_radius","onLoad","node","getChildByName","position","x","y","getComponent","contentSize","on","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","start","event","touchPos","getUILocation","setPosition","relativePos","length","scale","multiplyScalar","clone","normalize","console","log","update","deltaTime","onDestroy","off"],"mappings":"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","sourcesContent":["import { Input } from 'cc';\r\nimport { UITransform } from 'cc';\r\nimport { Vec2 } from 'cc';\r\nimport { EventTouch } from 'cc';\r\nimport { input } from 'cc';\r\nimport { _decorator, Component, Node } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('JoyStickManager')\r\nexport class JoyStickManager extends Component {\r\n    public output: Vec2 = Vec2.ZERO;\r\n    private _body: Node;\r\n    private _stick: Node;\r\n    private _defaultPos: Vec2;\r\n    private _radius: number;\r\n    input: any;\r\n\r\n    protected onLoad(): void {\r\n        this._body = this.node.getChildByName('Body');\r\n        this._stick = this._body.getChildByName('Stick');\r\n        this._defaultPos = new Vec2(this._body.position.x, this._body.position.y);\r\n        this._radius = this._body.getComponent(UITransform).contentSize.x / 2;\r\n\r\n        input.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        input.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        input.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\r\n    }\r\n    start() {\r\n\r\n    }\r\n    onTouchStart(event: EventTouch) {\r\n        const touchPos = event.getUILocation();\r\n        this._body.setPosition(touchPos.x, touchPos.y);\r\n    }\r\n    onTouchMove(event: EventTouch) {\r\n        const touchPos = event.getUILocation();\r\n        const relativePos: Vec2 = new Vec2(touchPos.x - this._body.position.x, touchPos.y - this._body.position.y);\r\n        if(relativePos.length() > this._radius) {\r\n            let scale: number = this._radius / relativePos.length();\r\n            relativePos.multiplyScalar(scale);\r\n        }\r\n        this._stick.setPosition(relativePos.x, relativePos.y);\r\n        this.output = relativePos.clone().normalize();\r\n        console.log(this.output);\r\n    }\r\n    onTouchEnd() {\r\n        this._body.setPosition(this._defaultPos.x, this._defaultPos.y);\r\n        this._stick.setPosition(0, 0);\r\n        this.output = Vec2.ZERO;\r\n    }\r\n    update(deltaTime: number) {\r\n        \r\n    }\r\n    protected onDestroy(): void {\r\n        input.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        input.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        input.off(Input.EventType.TOUCH_END, this.onTouchEnd, this);\r\n    }\r\n}\r\n\r\n\r\n"]}