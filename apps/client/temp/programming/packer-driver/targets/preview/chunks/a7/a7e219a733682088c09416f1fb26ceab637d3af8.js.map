{"version":3,"sources":["file:///C:/Users/ctwl/Downloads/cocos-nodejs-io-game-start-demo-master/apps/client/assets/Scripts/Entity/Bullet/BulletManager.ts"],"names":["_decorator","EntityManager","EntityTypeEnum","BulletStateMachine","EntityStateEnum","EventEnum","DataManager","rad2Angle","EventManager","ExplosionManager","ObjectPoolManager","ccclass","property","BulletManager","type","__id","init","data","id","fsm","addComponent","state","Idle","node","active","Instance","on","explosionBorn","handleExplosionBorn","x","y","explosion","get","Explosion","em","getComponent","off","bulletMap","delete","ret","render","direction","position","setPosition","side","Math","sqrt","angle","asin","rightAngle"],"mappings":"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","sourcesContent":["import { _decorator, Component } from 'cc';\r\nimport { EntityManager } from '../../Base/EntityManager';\r\nimport { IBullet, IVec2 } from '../../Common/State';\r\nimport { EntityTypeEnum, InputTypeEnum } from '../../Common/Enum';\r\nimport { BulletStateMachine } from './BulletStateMachine';\r\nimport { EntityStateEnum, EventEnum } from '../../Enum';\r\nimport DataManager from '../../Global/DataManager';\r\nimport { rad2Angle } from '../../Utils';\r\nimport EventManager from '../../Global/EventManager';\r\nimport { instantiate } from 'cc';\r\nimport { ExplosionManager } from '../Explosion/ExplosionManager';\r\nimport { ObjectPoolManager } from '../../Global/ObjectPoolManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('BulletManager')\r\nexport class BulletManager extends EntityManager {\r\n    public type: EntityTypeEnum;\r\n    private __id: number;\r\n\r\n    init(data: IBullet) {\r\n        this.type = data.type;\r\n        this.__id = data.id;\r\n        this.fsm = this.addComponent(BulletStateMachine);\r\n        this.fsm.init(data.type);\r\n\r\n        this.state = EntityStateEnum.Idle;\r\n        this.node.active = false;\r\n\r\n        EventManager.Instance.on(EventEnum.explosionBorn, this.handleExplosionBorn, this);\r\n    }\r\n\r\n    handleExplosionBorn(id: number, {x, y}: IVec2) {\r\n        if(id !== this.__id) {\r\n            return;\r\n        }\r\n\r\n        //处理子弹爆炸特效相关逻辑\r\n        const explosion = ObjectPoolManager.Instance.get(EntityTypeEnum.Explosion);\r\n        const em = explosion.getComponent(ExplosionManager) || explosion.addComponent(ExplosionManager);\r\n        em.init(EntityTypeEnum.Explosion, {x, y});\r\n\r\n        //处理子弹销毁的相关逻辑\r\n        EventManager.Instance.off(EventEnum.explosionBorn, this.handleExplosionBorn, this);\r\n        DataManager.Instance.bulletMap.delete(this.__id);\r\n        ObjectPoolManager.Instance.ret(this.node);\r\n    }\r\n\r\n    render(data: IBullet) {\r\n        this.node.active = true;\r\n        const {direction, position} = data;\r\n        this.node.setPosition(position.x, position.y);\r\n        \r\n        const side = Math.sqrt(direction.x ** 2 + direction.y ** 2);\r\n        const angle = rad2Angle(Math.asin(direction.y / side));\r\n        const rightAngle = rad2Angle(Math.asin(-direction.y / side)) + 180;\r\n        this.node.angle = direction.x > 0 ? angle : rightAngle;\r\n    }\r\n    \r\n}"]}