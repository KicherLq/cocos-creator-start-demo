{"version":3,"sources":["file:///C:/Users/ctwl/Downloads/cocos-nodejs-io-game-start-demo-master/apps/client/assets/Scripts/Entity/Weapon/WeaponStateMachine.ts"],"names":["_decorator","Animation","AnimationClip","State","StateMachine","getInitParamsTrigger","EntityStateEnum","ParamsNameEnum","WeaponManager","ccclass","WeaponStateMachine","init","type","animationComponent","node","addComponent","initParams","initStateMachines","initAnimationEvent","params","set","Idle","Attack","stateMachines","WrapMode","Loop","Normal","on","EventType","FINISHED","defaultClip","name","includes","parent","getComponent","state","run","currentState","get","value"],"mappings":"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","sourcesContent":["import { _decorator, Animation, AnimationClip } from \"cc\";\r\nimport State from \"../../Base/State\";\r\nimport StateMachine, { getInitParamsTrigger } from \"../../Base/StateMachine\";\r\nimport { EntityTypeEnum } from \"../../Common/Enum\";\r\nimport { EntityStateEnum, ParamsNameEnum } from \"../../Enum\";\r\nimport { WeaponManager } from \"./WeaponManager\";\r\nconst { ccclass } = _decorator;\r\n\r\n@ccclass(\"WeaponStateMachine\")\r\nexport class WeaponStateMachine extends StateMachine {\r\n    init(type: EntityTypeEnum) {\r\n        this.type = type;\r\n        this.animationComponent = this.node.addComponent(Animation);\r\n        this.initParams();\r\n        this.initStateMachines();\r\n        this.initAnimationEvent();\r\n    }\r\n\r\n    initParams() {\r\n        this.params.set(ParamsNameEnum.Idle, getInitParamsTrigger());\r\n        this.params.set(ParamsNameEnum.Attack, getInitParamsTrigger());\r\n    }\r\n\r\n    initStateMachines() {\r\n        this.stateMachines.set(ParamsNameEnum.Idle, new State(this, `${this.type}${EntityStateEnum.Idle}`, AnimationClip.WrapMode.Loop, true));\r\n        this.stateMachines.set(ParamsNameEnum.Attack, new State(this, `${this.type}${EntityStateEnum.Attack}`, AnimationClip.WrapMode.Normal, true));\r\n    }\r\n\r\n    initAnimationEvent() { \r\n        this.animationComponent.on(Animation.EventType.FINISHED, () => {\r\n            if(this.animationComponent.defaultClip.name.includes(EntityStateEnum.Attack)) {\r\n                this.node.parent.getComponent(WeaponManager).state = EntityStateEnum.Idle;\r\n            }\r\n        });\r\n    }\r\n\r\n    run() {\r\n        switch (this.currentState) {\r\n            case this.stateMachines.get(ParamsNameEnum.Idle):\r\n            case this.stateMachines.get(ParamsNameEnum.Attack):\r\n                if (this.params.get(ParamsNameEnum.Attack).value) {\r\n                    this.currentState = this.stateMachines.get(ParamsNameEnum.Attack);\r\n                } else if (this.params.get(ParamsNameEnum.Idle).value) {\r\n                    this.currentState = this.stateMachines.get(ParamsNameEnum.Idle);\r\n                } else {\r\n                    this.currentState = this.currentState;\r\n                }\r\n                break;\r\n            default:\r\n                this.currentState = this.stateMachines.get(ParamsNameEnum.Idle);\r\n                break;\r\n        }\r\n    }\r\n}\r\n"]}